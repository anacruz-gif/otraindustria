<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TUVN - Monitoreo Térmico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

<style>
    body { font-family: 'Roboto', sans-serif; transition: background-color 0.8s ease; }
    .thermometer { width: 30px; height: 120px; position: relative; margin: 0 auto 10px; }
    .thermometer-bulb { width: 30px; height: 30px; background: #ef4444; border-radius: 50%; position: absolute; bottom: 0; left: 0; }
    .thermometer-tube { width: 10px; height: 90px; background: #e5e7eb; border: 2px solid #9ca3af; border-radius: 5px 5px 0 0; position: absolute; bottom: 15px; left: 10px; overflow: hidden; }
    .thermometer-mercury { width: 100%; background: linear-gradient(to top, #ef4444, #f97316, #fbbf24); position: absolute; bottom: 0; transition: height 0.8s ease; }
    
    @keyframes fan-spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }
    .spin { animation: fan-spin 0.8s linear infinite; }

    @keyframes heat-wave { 0%,100%{opacity:1;} 50%{opacity:0.3;} }
    .heater-on{ animation: heat-wave 1s infinite; }
</style>

</head>

<body class="bg-slate-50 min-h-screen flex flex-col">

<!-- ======================
     HEADER (igual que el tuyo)
======================= -->
<header class="bg-blue-900 text-white shadow-lg border-b-4 border-red-600">
    <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="flex items-center gap-3">
            <div class="bg-white p-2 rounded-full">
                <i data-lucide="graduation-cap" class="w-8 h-8 text-blue-900"></i>
            </div>
            <div>
                <h1 class="text-2xl font-bold tracking-tight">TUVN</h1>
                <p class="text-xs text-blue-200 font-semibold tracking-widest">AUTOMATIZACIÓN E INSTRUMENTACIÓN</p>
            </div>
        </div>

        <div class="flex items-center gap-3 bg-blue-950/50 px-4 py-2 rounded-lg border border-blue-400/30">
            <span id="statusText" class="text-sm font-mono text-red-200">Desconectado</span>
        </div>
    </div>
</header>

<!-- ======================
      CUERPO PRINCIPAL
======================= -->
<main class="container mx-auto px-4 py-8">

    <h2 class="text-3xl font-bold text-center mb-6">Monitoreo de Temperatura</h2>

    <!-- ======================
         4 SENSORES
    ======================= -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">

        <!-- SENSOR TEMPLATE (SE REPITE 4 VECES) -->
        <div class="bg-white shadow rounded-xl p-5 text-center">
            <h3 class="font-bold text-blue-700">Sensor 1</h3>
            <div class="thermometer">
                <div class="thermometer-tube">
                    <div class="thermometer-mercury" id="mer1"></div>
                </div>
                <div class="thermometer-bulb"></div>
            </div>
            <div class="text-4xl font-bold" id="s1">--</div>
        </div>

        <div class="bg-white shadow rounded-xl p-5 text-center">
            <h3 class="font-bold text-red-700">Sensor 2</h3>
            <div class="thermometer">
                <div class="thermometer-tube">
                    <div class="thermometer-mercury" id="mer2"></div>
                </div>
                <div class="thermometer-bulb"></div>
            </div>
            <div class="text-4xl font-bold" id="s2">--</div>
        </div>

        <div class="bg-white shadow rounded-xl p-5 text-center">
            <h3 class="font-bold text-blue-700">Sensor 3</h3>
            <div class="thermometer">
                <div class="thermometer-tube">
                    <div class="thermometer-mercury" id="mer3"></div>
                </div>
                <div class="thermometer-bulb"></div>
            </div>
            <div class="text-4xl font-bold" id="s3">--</div>
        </div>

        <div class="bg-white shadow rounded-xl p-5 text-center">
            <h3 class="font-bold text-red-700">Sensor 4</h3>
            <div class="thermometer">
                <div class="thermometer-tube">
                    <div class="thermometer-mercury" id="mer4"></div>
                </div>
                <div class="thermometer-bulb"></div>
            </div>
            <div class="text-4xl font-bold" id="s4">--</div>
        </div>

    </div>

    <!-- ======================
         TERMÓMETRO GENERAL
    ======================= -->
    <div class="bg-white shadow-xl rounded-xl p-8 text-center mb-10">
        <h3 class="text-2xl font-bold mb-3">Temperatura General</h3>

        <div class="thermometer mx-auto">
            <div class="thermometer-tube">
                <div class="thermometer-mercury" id="merGeneral"></div>
            </div>
            <div class="thermometer-bulb"></div>
        </div>

        <div id="generalTemp" class="text-6xl font-bold my-4">--</div>
    </div>

    <!-- ======================
         MODO AUTOMÁTICO / MANUAL
    ======================= -->
    <div class="bg-white shadow-xl rounded-xl p-8">

        <h3 class="text-xl font-bold mb-4">Control del Sistema</h3>

        <label class="font-bold">Modo:</label>
        <select id="modeSelect" class="border p-2 rounded-md mb-4">
            <option value="auto">Automático</option>
            <option value="manual">Manual</option>
        </select>

        <!-- ESTADO ACTUAL -->
        <div class="mt-4 font-bold text-lg">
            Ventilador: <span id="fanState" class="text-blue-700">OFF</span>  
            <br>
            Calefactor: <span id="heaterState" class="text-red-700">OFF</span>
        </div>

        <!-- ÍCONOS -->
        <div class="flex justify-center gap-20 my-6 text-center">

            <div>
                <i id="fanIcon" data-lucide="fan" class="w-16 h-16 text-blue-600"></i>
            </div>

            <div>
                <i id="heaterIcon" data-lucide="flame" class="w-16 h-16 text-red-600"></i>
            </div>

        </div>

        <!-- CONTROLES MANUALES -->
        <div id="manualControls" class="hidden mt-6">
            <h3 class="text-lg font-bold mb-3">Controles Manuales</h3>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="fanOn()" class="bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-md">Encender Ventilador</button>
                <button onclick="fanOff()" class="bg-blue-900 hover:bg-blue-950 text-white py-3 rounded-md">Apagar Ventilador</button>

                <button onclick="heaterOn()" class="bg-red-600 hover:bg-red-700 text-white py-3 rounded-md">Encender Calefactor</button>
                <button onclick="heaterOff()" class="bg-red-900 hover:bg-red-950 text-white py-3 rounded-md">Apagar Calefactor</button>
            </div>
        </div>

    </div>

</main>

<script>
lucide.createIcons();

/* ===============================
     ACTUALIZACIÓN DE TERMÓMETROS
=================================*/
function setMercury(id, temp){
    let p = (temp / 50) * 100;
    p = Math.max(0, Math.min(p,100));
    document.getElementById(id).style.height = p + "%";
}

/* ===============================
     SISTEMA DE MODOS
=================================*/
let mode = "auto";
let fan = false;
let heater = false;

document.getElementById("modeSelect").addEventListener("change", (e)=>{
    mode = e.target.value;

    if(mode === "manual"){
        document.getElementById("manualControls").classList.remove("hidden");
    } else {
        document.getElementById("manualControls").classList.add("hidden");
    }
});

/* ====== Control manual ====== */
function fanOn(){ fan = true; updateStates(); }
function fanOff(){ fan = false; updateStates(); }
function heaterOn(){ heater = true; updateStates(); }
function heaterOff(){ heater = false; updateStates(); }

/* ====== Actualiza estados visuales ====== */
function updateStates(){
    document.getElementById("fanState").innerText = fan ? "ENCENDIDO" : "APAGADO";
    document.getElementById("heaterState").innerText = heater ? "ENCENDIDO" : "APAGADO";

    const fanIcon = document.getElementById("fanIcon");
    const heaterIcon = document.getElementById("heaterIcon");

    if(fan) fanIcon.classList.add("spin");
    else fanIcon.classList.remove("spin");

    if(heater) heaterIcon.classList.add("heater-on");
    else heaterIcon.classList.remove("heater-on");
}

/* ===============================
     LÓGICA AUTOMÁTICA
=================================*/
function autoLogic(avg){
    if(mode !== "auto") return;

    if(avg > 25){
        fan = true;
        heater = false;
    } 
    else if(avg < 20){
        fan = false;
        heater = true;
    } 
    else {
        fan = false;
        heater = false;
    }

    updateStates();
}

/* ===============================
     SIMULAMOS RECEPCIÓN BLE
     (REMPLAZA ESTO CON ESP32 REAL)
=================================*/
function handleData(data){

    /* Mostrar sensores */
    document.getElementById("s1").innerText = data.s1.toFixed(1);
    document.getElementById("s2").innerText = data.s2.toFixed(1);
    document.getElementById("s3").innerText = data.s3.toFixed(1);
    document.getElementById("s4").innerText = data.s4.toFixed(1);

    setMercury("mer1", data.s1);
    setMercury("mer2", data.s2);
    setMercury("mer3", data.s3);
    setMercury("mer4", data.s4);

    /* Calcular general */
    const avg = (data.s1 + data.s2 + data.s3 + data.s4) / 4;
    document.getElementById("generalTemp").innerText = avg.toFixed(1);
    setMercury("merGeneral", avg);

    /* Modo automático */
    autoLogic(avg);
}

/* ============ EJEMPLO DE PRUEBA ============ */
setInterval(()=>{
    const fake = {
        s1: 20 + Math.random()*10,
        s2: 20 + Math.random()*10,
        s3: 20 + Math.random()*10,
        s4: 20 + Math.random()*10
    };
    handleData(fake);
}, 2000);

</script>

</body>
</html>
